{% extends 'base.html.twig' %}

{% block title %} Tournages | Marvel-Passion {% endblock %}

{% block stylesheets %}

    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />

{% endblock %}

{% block body %}

<section>
    <h1 class="title text-center mb-5">Tournages</h1>

    <div id="map" class="mb-3"></div>
    
    <p class="informations-shooting subtitle-shooting text-center mt-5 p-2">
        <img class="img-marker-shooting" src="{{ asset('images/mapbox-icon.png') }}" alt="Marker mapbox">
        Veuillez s√©lectionner un lieu de tournage sur la carte pour afficher ses informations correspondante.
    </p>

    <div class="hide mt-5 text-center">

        <div class="mt-3 mb-3">
            <span class="font-weight-bold subtitle-shooting">Titre : </span>
            <span id="title-shooting"></span>
        </div>

        <div class="mt-3 mb-3">
            <span class="font-weight-bold subtitle-shooting">Adresse : </span>
            <span id="address-shooting"></span>
        </div>

        <div class="mb-3">
            <span class="font-weight-bold subtitle-shooting">Type : </span>
            <span id="type"></span>
        </div>
        
        <div class="mb-5">
            <span class="font-weight-bold subtitle-shooting">Description : </span>
            <span id="description-shooting"></span>
        </div>

        <p class="mb-3 subtitle font-weight-bold">Image du lieu de tournage</p>

        <div class="mt-3 mb-3 ml-3 mr-3" id="img-shooting"></div>

    </div>

</section>

{% endblock %}

{% block javascript %}

<script src="{{ asset('js/shooting.js') }}"></script>
<script>

    mapboxgl.accessToken = 'pk.eyJ1IjoibmFtaXN3YW4iLCJhIjoiY2pyejMxaHRhMGQ5cTQzbDl0amtlb2M3aCJ9.m70wpc1DNfHE2FeddLU9lQ';

    var map = new mapboxgl.Map({

        container: 'map',
        zoom: 1,
        style: 'mapbox://styles/mapbox/streets-v9',

    });

    var geojson = 
    {
        type: 'FeatureCollection',
        features: 
        [
            {% for shooting in shootings %}

            {
                type: 'Feature',
                geometry: 
                {
                    type: 'Point',
                    coordinates: [{{ shooting.lng }} , {{ shooting.lat }}]
                },
                properties:
                {
                    id: {{ shooting.id }},
                    title: "{{ shooting.title }}"
                }
            },

            {% endfor %}
        ]
    };

    geojson.features.forEach(function(marker) 
    {
        var el = document.createElement('div');
        $(el).addClass('marker');

        new mapboxgl.Marker(el)
            .setLngLat(marker.geometry.coordinates)
            .setPopup(new mapboxgl.Popup({offset: 25})
                .setHTML('<h3 class="font-weight-bold subtitle-shooting">' + marker.properties.title + '</h3>'))
            .addTo(map);

        $(el).click(function ()
            { 
                getShooting(marker.properties.id);
            }
        );
    });

</script>

{% endblock %}
